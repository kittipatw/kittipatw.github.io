<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Dernjoot</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.1/font/bootstrap-icons.css" />

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <style>
    .hide {
      display: none;
    }

    #toggle-question-setting {
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #toggle-question-setting.fade-in {
      opacity: 1;
    }
  </style>
</head>

<body style="height: 100vh; width: 100vw;">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <!-- Left column: Branding -->
      <div class="col text-start d-flex align-items-center">
        <a class="navbar-brand ms-3 fw-lighter" href="/"><b>Dernjoot</b> v2.1.1</a>
        <!-- <span class="badge text-bg-warning">Beta</span> -->
      </div>

      <!-- Center column: Menu bar -->
      <div class="col text-center">
        <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <li class="nav-item mx-2">
              <!-- <a class="nav-link active" href="">Dernjoot</a> -->
            </li>
          </ul>
        </div>
      </div>

      <!-- Right column: Developed by -->
      <div class="col text-end">
        <span class="navbar-text me-3">by kittipatw</span>
      </div>
    </div>
  </nav>

  <!-- Toast Container -->
  <div id="status-toast" class="toast-container position-fixed bottom-0 start-50 translate-middle-x p-5"></div>

  <div class="container text-center mt-4" style="height: 85%;">
    <div class="row" style="height: 15%;">
      <div
        class="col bg-secondary border border-dark border-opacity-25 rounded d-flex flex-column align-items-center justify-content-center"
        style="--bs-bg-opacity: .05;">

        <div class="d-flex align-items-center">
          <button id='rhythm-toggle-btn' type="button" class="btn btn-primary">Start</button>
          <label class="form-label ms-3" style="width: 200px;">
            BPM: <span id="bpm-display">60</span>
            <input type="range" class="form-range" id="bpm-slider" min="40" max="100" value="60" step="5">
          </label>
        </div>

        <div class="d-flex align-items-center">
          <div class="form-check ms-3">
            <input class="form-check-input" type="checkbox" value="" id="random-metronome">
            <label class="form-check-label" for="random-metronome">
              Random Metronome
            </label>
          </div>
        </div>

      </div>
      <div class="col-1"></div>
      <div
        class="col bg-secondary border border-dark border-opacity-25 rounded d-flex flex-column justify-content-center"
        style="--bs-bg-opacity: .05;">
        <div class="row" style="height: 40%;">
          <div class="col d-flex align-items-center justify-content-center form-check form-switch">
            <input class="form-check-input me-2" type="checkbox" id="hide-question">
            <label class="form-check-label" for="hide-question">Hide question</label>
          </div>
          <div id="readAnswerControl"
            class="col d-none d-flex align-items-center justify-content-center form-check form-switch">
            <input class="form-check-input me-2" type="checkbox" id="voice" checked>
            <label class="form-check-label" for="voice">Voice</label>
          </div>
        </div>

        <div id="voice-control" class="row d-none" style="height: 40%;">
          <div class="col-6 d-flex align-items-center justify-content-center form-check form-switch"
            style="height: 100%;">
            <input class="form-check-input me-2" type="checkbox" id="read-answer" checked>
            <label class="form-check-label" for="read-answer">Read answer</label>
          </div>
          <div class="col-6 d-flex align-items-center justify-content-center" style="height: 100%;">
            <label class="me-2">Language</label>
            <div class="btn-group btn-group-sm" role="group" aria-label="Basic radio toggle button group">
              <input type="radio" class="btn-check" name="btnradio" id="btn-en" autocomplete="off" checked>
              <label class="btn btn-outline-primary" for="btn-en">EN</label>

              <input type="radio" class="btn-check" name="btnradio" id="btn-th" autocomplete="off">
              <label class="btn btn-outline-primary" for="btn-th">TH</label>
            </div>
          </div>
        </div>
        <div id="voice-activation-panel" class="row d-none" style="height: 40%;">
          <div class="col d-flex align-items-center justify-content-center">
            <label class="text-danger me-3">Voice activation needed!</label>
            <button type="button" class="btn btn-sm btn-danger" id="voiceTest">Activate Voice</button>
          </div>
        </div>
      </div>
    </div>

    <div class="row touch-area d-flex align-items-end justify-content-center" style="height: 25%;">
      <div id="small-label" class="mb-4" style="font-size: 3em; line-height: 1;">Press spacebar to
        begin.</div>
    </div>
    <div class="row touch-area d-flex align-items-start justify-content-center" style="height: 35%;">
      <div id="big-label" class="" style="font-size: 10em; line-height: 1;"></div>
    </div>
    <div class="row" style="height: 25%;">
      <!-- <div id="debug-area">
      </div> -->
      <div class="d-flex align-items-end justify-content-start p-0">
        <button id="toggle-question-setting" class="btn btn-outline-secondary fade-in" type="button"
          data-bs-toggle="collapse" data-bs-target="#collapseSettings" aria-expanded="true"
          aria-controls="collapseSettings">
          Question Settings
        </button>
        <div id="collapseSettings" class="collapse collapse-horizontal">
          <div class="card" style="height: 100%; width: 350px;">
            <div class="card-header d-flex justify-content-between align-items-center"
              style="text-align: left !important;">
              <span>Question Settings</span>
              <button id="toggle-question-setting-close-btn" class="btn-close" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapseSettings" aria-expanded="true" aria-controls="collapseSettings"></button>
            </div>

            <div class="card-body" style="text-align: left !important;">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="time_question">
                <label class="form-check-label" for="time_question">
                  Include <span style="font-weight: bold; color: #FFC107;">TIME</span> questions
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="geography_question">
                <label class="form-check-label" for="geography_question">
                  Include <span style="font-weight: bold; color: #FFC107;">GEOGRAPHY</span> questions
                </label>
              </div>
              <!-- <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="general_question">
                <label class="form-check-label" for="general_question">
                  Include General questions
                </label>
              </div> -->
            </div>
          </div>
        </div>

      </div>
      <!-- <div class="col-1"></div>
      <div class="col"></div> -->

    </div>

  </div>

  <script>
    function createToast(message, type) {
      const toastContainer = document.querySelector("#status-toast");

      const toast = document.createElement("div");
      toast.className = `toast align-items-center text-bg-${type} border-0`;
      toast.setAttribute("role", "alert");
      toast.setAttribute("aria-live", "assertive");
      toast.setAttribute("aria-atomic", "true");

      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      `;

      toastContainer.appendChild(toast);
      const bootstrapToast = new bootstrap.Toast(toast);
      bootstrapToast.show();
      toast.addEventListener("hidden.bs.toast", () => {
        toast.remove();
      });
    }

    document.getElementById('toggle-question-setting').addEventListener('click', () => {
      document.getElementById('toggle-question-setting').classList.add('hide');
      document.getElementById('toggle-question-setting').classList.remove('fade-in');
    });

    document.getElementById('toggle-question-setting-close-btn').addEventListener('click', () => {
      setTimeout(() => {
        document.getElementById('toggle-question-setting').classList.remove('hide');
      }, 400);
      setTimeout(() => {
        document.getElementById('toggle-question-setting').classList.add('fade-in');
      }, 450);
    });

    if ('speechSynthesis' in window) {
      speechSynthesis.cancel();
      speechSynthesis.getVoices();
    }

    const testSpeak = () => {
      const utter = new SpeechSynthesisUtterance("Voice activated");
      speechSynthesis.speak(utter);
      voiceControl.classList.remove('d-none');
      voiceActivationPanel.classList.add('d-none');
      readAnswerControl.classList.remove('d-none');
      createToast(
        `If you hear "Voice Activated!", voice is working properly. Otherwise, voice may not work.`,
        "warning"
      );
      read_question = true;
    };

    voiceTest.addEventListener('click', testSpeak);

    const small_label = document.getElementById("small-label");

    const voiceControl = document.getElementById("voice-control");
    const voiceActivationPanel = document.getElementById("voice-activation-panel");

    function updateInitialStatus() {
      const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      if (isMobile || navigator.maxTouchPoints > 1) {
        small_label.innerText = "Touch anywhere to begin.";
      } else {
        small_label.innerText = "Press spacebar to begin.";
      }

      const isAppleDevice = /(Mac|iPhone|iPad|iPod)/i.test(navigator.userAgent);

      if (isAppleDevice || true) {
        if (voiceControl) {
          voiceControl.classList.add('d-none');
        }
        if (voiceActivationPanel) {
          voiceActivationPanel.classList.remove('d-none');
        }
      }
    }
    updateInitialStatus();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>
  <script src="metronome.js"></script>
  <script src="question_generation.js"></script>
  <script src="math_question.js"></script>
  <script src="time_question.js"></script>
  <script src="geography_question.js"></script>
</body>

</html>